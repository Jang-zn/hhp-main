# Kafka ì„¤ì • ë° ìš´ì˜ ê°€ì´ë“œ

## ğŸ“š ëª©ì°¨
1. [Kafka ê¸°ë³¸ ê°œë…](#kafka-ê¸°ë³¸-ê°œë…)
2. [KRaft ëª¨ë“œ vs ZooKeeper ëª¨ë“œ](#kraft-ëª¨ë“œ-vs-zookeeper-ëª¨ë“œ)
3. [ë¡œì»¬ ê°œë°œí™˜ê²½ ì„¤ì •](#ë¡œì»¬-ê°œë°œí™˜ê²½-ì„¤ì •)
4. [Spring Boot Kafka ì„¤ì •](#spring-boot-kafka-ì„¤ì •)
5. [ì¼ë°˜ì ì¸ ì—ëŸ¬ ì¼€ì´ìŠ¤ ë° í•´ê²°ë°©ì•ˆ](#ì¼ë°˜ì ì¸-ì—ëŸ¬-ì¼€ì´ìŠ¤-ë°-í•´ê²°ë°©ì•ˆ)
6. [ì„±ëŠ¥ íŠœë‹ ë° ëª¨ë‹ˆí„°ë§](#ì„±ëŠ¥-íŠœë‹-ë°-ëª¨ë‹ˆí„°ë§)
7. [ìš´ì˜ í™˜ê²½ ê³ ë ¤ì‚¬í•­](#ìš´ì˜-í™˜ê²½-ê³ ë ¤ì‚¬í•­)

---

## Kafka ê¸°ë³¸ ê°œë…

### í•µì‹¬ êµ¬ì„±ìš”ì†Œ
- **Broker**: ë©”ì‹œì§€ë¥¼ ì €ì¥í•˜ê³  ì „ë‹¬í•˜ëŠ” Kafka ì„œë²„
- **Topic**: ë©”ì‹œì§€ê°€ ë¶„ë¥˜ë˜ëŠ” ì¹´í…Œê³ ë¦¬
- **Partition**: Topicì„ ë¶„í• í•œ ë‹¨ìœ„, ë³‘ë ¬ ì²˜ë¦¬ì™€ í™•ì¥ì„± ì œê³µ
- **Producer**: ë©”ì‹œì§€ë¥¼ Topicì— ë°œí–‰í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸
- **Consumer**: Topicì—ì„œ ë©”ì‹œì§€ë¥¼ êµ¬ë…í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸
- **Consumer Group**: ë™ì¼í•œ Topicì„ ë¶„ë‹´í•´ì„œ ì²˜ë¦¬í•˜ëŠ” Consumerë“¤ì˜ ê·¸ë£¹

### ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥
```
Topic: user-events (3 partitions)
â”Œâ”€ Partition 0: user:1 â†’ user:1 â†’ user:1  (ìˆœì„œ ë³´ì¥)
â”œâ”€ Partition 1: user:2 â†’ user:2 â†’ user:2  (ìˆœì„œ ë³´ì¥)  
â””â”€ Partition 2: user:3 â†’ user:3 â†’ user:3  (ìˆœì„œ ë³´ì¥)

ê°™ì€ íŒŒí‹°ì…˜ ë‚´ì—ì„œë§Œ ìˆœì„œê°€ ë³´ì¥ë¨!
```

---

## KRaft ëª¨ë“œ vs ZooKeeper ëª¨ë“œ

### KRaft ëª¨ë“œ (Kafka 2.8+, 3.0+ì—ì„œ ì•ˆì •í™”)

**ì¥ì :**
- ZooKeeper ì˜ì¡´ì„± ì œê±°ë¡œ ì•„í‚¤í…ì²˜ ë‹¨ìˆœí™”
- ë” ë¹ ë¥¸ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬
- ë©”íƒ€ë°ì´í„° íŒŒí‹°ì…˜ì„ í†µí•œ í™•ì¥ì„± ê°œì„ 
- ìš´ì˜ ë³µì¡ë„ ê°ì†Œ

**ë‹¨ì :**
- ìƒëŒ€ì ìœ¼ë¡œ ìƒˆë¡œìš´ ê¸°ìˆ  (ìš´ì˜ ê²½í—˜ ë¶€ì¡±)
- ì¼ë¶€ ê¸°ëŠ¥ì´ ì•„ì§ ì™„ì „í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

### ZooKeeper ëª¨ë“œ (ì „í†µì  ë°©ì‹)

**ì¥ì :**
- ê²€ì¦ëœ ì•ˆì •ì„±
- í’ë¶€í•œ ìš´ì˜ ê²½í—˜ê³¼ ë¬¸ì„œ
- ëª¨ë“  ê¸°ëŠ¥ ì§€ì›

**ë‹¨ì :**
- ZooKeeper í´ëŸ¬ìŠ¤í„° ë³„ë„ ê´€ë¦¬ í•„ìš”
- ë©”íƒ€ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥ ì œí•œ
- ì•„í‚¤í…ì²˜ ë³µì¡ë„ ì¦ê°€

### ì„ íƒ ê¸°ì¤€
```
KRaft ê¶Œì¥: ìƒˆë¡œìš´ í”„ë¡œì íŠ¸, ë‹¨ìˆœí•œ ì•„í‚¤í…ì²˜ ì„ í˜¸
ZooKeeper ê¶Œì¥: ê¸°ì¡´ ìš´ì˜ ì¤‘ì¸ ì‹œìŠ¤í…œ, ì•ˆì •ì„± ìµœìš°ì„ 
```

---

## ë¡œì»¬ ê°œë°œí™˜ê²½ ì„¤ì •

### 1. Kafka ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜

```bash
# 1. Kafka ë‹¤ìš´ë¡œë“œ (2.13-3.6.1 ë²„ì „ ì˜ˆì‹œ)
wget https://downloads.apache.org/kafka/3.6.1/kafka_2.13-3.6.1.tgz
tar -xzf kafka_2.13-3.6.1.tgz
cd kafka_2.13-3.6.1

# 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì„ íƒì‚¬í•­)
export KAFKA_HOME=/path/to/kafka_2.13-3.6.1
export PATH=$PATH:$KAFKA_HOME/bin
```

### 2. KRaft ëª¨ë“œë¡œ Kafka ì‹¤í–‰

```bash
# 1. í´ëŸ¬ìŠ¤í„° UUID ìƒì„±
KAFKA_CLUSTER_ID="$(bin/kafka-storage.sh random-uuid)"

# 2. ë¡œê·¸ ë””ë ‰í† ë¦¬ í¬ë§·
bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties

# 3. Kafka ì„œë²„ ì‹œì‘
bin/kafka-server-start.sh config/kraft/server.properties
```

### 3. Docker Composeë¥¼ ì´ìš©í•œ ì„¤ì •

```yaml
# docker-compose.yml
version: '3.8'
services:
  kafka:
    image: confluentinc/cp-kafka:7.4.0
    hostname: kafka
    container_name: kafka
    ports:
      - "9092:9092"
      - "9101:9101"
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: 'CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT'
      KAFKA_ADVERTISED_LISTENERS: 'PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092'
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
      KAFKA_JMX_PORT: 9101
      KAFKA_JMX_HOSTNAME: localhost
      KAFKA_PROCESS_ROLES: 'broker,controller'
      KAFKA_CONTROLLER_QUORUM_VOTERS: '1@kafka:29093'
      KAFKA_LISTENERS: 'PLAINTEXT://kafka:29092,CONTROLLER://kafka:29093,PLAINTEXT_HOST://0.0.0.0:9092'
      KAFKA_INTER_BROKER_LISTENER_NAME: 'PLAINTEXT'
      KAFKA_CONTROLLER_LISTENER_NAMES: 'CONTROLLER'
      KAFKA_LOG_DIRS: '/tmp/kraft-combined-logs'
      CLUSTER_ID: 'MkU3OEVBNTcwNTJENDM2Qk'
```

### 4. ê¸°ë³¸ í…ŒìŠ¤íŠ¸

```bash
# 1. í† í”½ ìƒì„±
bin/kafka-topics.sh --create --topic test-topic --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1

# 2. ë©”ì‹œì§€ ë°œí–‰
echo "Hello Kafka" | bin/kafka-console-producer.sh --topic test-topic --bootstrap-server localhost:9092

# 3. ë©”ì‹œì§€ ì†Œë¹„
bin/kafka-console-consumer.sh --topic test-topic --from-beginning --bootstrap-server localhost:9092
```

---

## Spring Boot Kafka ì„¤ì •

### 1. ì˜ì¡´ì„± ì¶”ê°€

```kotlin
// build.gradle.kts
dependencies {
    // Kafka
    implementation("org.springframework.kafka:spring-kafka")
    testImplementation("org.springframework.kafka:spring-kafka-test")
    testImplementation("org.testcontainers:kafka") // í…ŒìŠ¤íŠ¸ìš©
}
```

### 2. ì„¤ì • íŒŒì¼ (application.yml)

```yaml
spring:
  kafka:
    bootstrap-servers: localhost:9092
    
    # Producer ì„¤ì •
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all                    # ëª¨ë“  ë³µì œë³¸ì—ì„œ í™•ì¸
      retries: 3                   # ì¬ì‹œë„ íšŸìˆ˜
      batch-size: 16384           # ë°°ì¹˜ í¬ê¸° (16KB)
      linger-ms: 1                # ë°°ì¹˜ ëŒ€ê¸° ì‹œê°„
      buffer-memory: 33554432     # ì´ ë©”ëª¨ë¦¬ (32MB)
      properties:
        enable.idempotence: true  # ë©±ë“±ì„± ë³´ì¥
        max.in.flight.requests.per.connection: 5
    
    # Consumer ì„¤ì •
    consumer:
      group-id: my-service
      auto-offset-reset: earliest  # ì²˜ìŒë¶€í„° ì½ê¸°
      enable-auto-commit: false   # ìˆ˜ë™ ì»¤ë°‹
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.example.events"
        max.poll.records: 500       # í•œ ë²ˆì— ê°€ì ¸ì˜¬ ìµœëŒ€ ë ˆì½”ë“œ ìˆ˜
        max.poll.interval.ms: 300000 # ìµœëŒ€ í´ë§ ê°„ê²© (5ë¶„)
        session.timeout.ms: 10000    # ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ (10ì´ˆ)
        heartbeat.interval.ms: 3000  # í•˜íŠ¸ë¹„íŠ¸ ê°„ê²© (3ì´ˆ)
```

### 3. Configuration í´ë˜ìŠ¤

```java
@Configuration
@EnableKafka
public class KafkaConfig {

    @Value("${spring.kafka.bootstrap-servers}")
    private String bootstrapServers;

    // Producer ì„¤ì •
    @Bean
    public ProducerFactory<String, Object> producerFactory() {
        Map<String, Object> configProps = new HashMap<>();
        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);
        
        // ì„±ëŠ¥ ë° ì•ˆì •ì„± ì„¤ì •
        configProps.put(ProducerConfig.ACKS_CONFIG, "all");
        configProps.put(ProducerConfig.RETRIES_CONFIG, 3);
        configProps.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);
        
        return new DefaultKafkaProducerFactory<>(configProps);
    }

    @Bean
    public KafkaTemplate<String, Object> kafkaTemplate() {
        return new KafkaTemplate<>(producerFactory());
    }

    // Consumer ì„¤ì •
    @Bean
    public ConsumerFactory<String, Object> consumerFactory() {
        Map<String, Object> props = new HashMap<>();
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);
        props.put(ConsumerConfig.GROUP_ID_CONFIG, "my-service");
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);
        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");
        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);
        
        // JSON ì—­ì§ë ¬í™” ì„¤ì •
        props.put(JsonDeserializer.TRUSTED_PACKAGES, "com.example.events");
        
        return new DefaultKafkaConsumerFactory<>(props);
    }

    @Bean
    public ConcurrentKafkaListenerContainerFactory<String, Object> kafkaListenerContainerFactory() {
        ConcurrentKafkaListenerContainerFactory<String, Object> factory = 
            new ConcurrentKafkaListenerContainerFactory<>();
        factory.setConsumerFactory(consumerFactory());
        
        // ìˆ˜ë™ ACK ì„¤ì •
        factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL_IMMEDIATE);
        
        // ì—ëŸ¬ í•¸ë“¤ë§
        factory.setCommonErrorHandler(new DefaultErrorHandler(
            (record, exception) -> {
                log.error("Kafka ë©”ì‹œì§€ ì²˜ë¦¬ ì‹¤íŒ¨: {}", record, exception);
            }
        ));
        
        return factory;
    }
}
```

### 4. Producer ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
public class EventPublisher {
    
    @Autowired
    private KafkaTemplate<String, Object> kafkaTemplate;
    
    public void publishEvent(String topic, String key, Object event) {
        CompletableFuture<SendResult<String, Object>> future = 
            kafkaTemplate.send(topic, key, event);
            
        future.whenComplete((result, ex) -> {
            if (ex == null) {
                log.info("ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ: topic={}, partition={}, offset={}", 
                        topic, result.getRecordMetadata().partition(), 
                        result.getRecordMetadata().offset());
            } else {
                log.error("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: topic={}", topic, ex);
            }
        });
    }
}
```

### 5. Consumer ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
public class EventConsumer {
    
    @KafkaListener(topics = "user-events", groupId = "user-service")
    public void handleUserEvent(
            ConsumerRecord<String, UserEvent> record,
            Acknowledgment ack) {
        try {
            UserEvent event = record.value();
            log.info("ì‚¬ìš©ì ì´ë²¤íŠ¸ ìˆ˜ì‹ : {}", event);
            
            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬
            processUserEvent(event);
            
            // ìˆ˜ë™ ì»¤ë°‹
            ack.acknowledge();
            
        } catch (Exception e) {
            log.error("ì‚¬ìš©ì ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨: {}", record.value(), e);
            // ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ (ì¬ì‹œë„, DLQ ì „ì†¡ ë“±)
        }
    }
}
```

---

## ì¼ë°˜ì ì¸ ì—ëŸ¬ ì¼€ì´ìŠ¤ ë° í•´ê²°ë°©ì•ˆ

### 1. ì—°ê²° ê´€ë ¨ ì—ëŸ¬

#### Error: Connection refused

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
org.apache.kafka.common.errors.TimeoutException: 
Failed to update metadata after 60000 ms.
```

**ì›ì¸:**
- Kafka ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
- ì˜ëª»ëœ bootstrap-servers ì„¤ì •
- ë°©í™”ë²½ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

**í•´ê²°ë°©ì•ˆ:**
```bash
# 1. Kafka ì„œë²„ ìƒíƒœ í™•ì¸
ps aux | grep kafka

# 2. í¬íŠ¸ í™•ì¸
netstat -tlnp | grep :9092

# 3. ì—°ê²° í…ŒìŠ¤íŠ¸
telnet localhost 9092

# 4. ì„¤ì • íŒŒì¼ í™•ì¸
cat config/server.properties | grep listeners
```

#### Error: DNS Resolution

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
java.net.UnknownHostException: kafka
```

**í•´ê²°ë°©ì•ˆ:**
```yaml
# Docker í™˜ê²½ì—ì„œ localhostë¡œ ë³€ê²½
spring:
  kafka:
    bootstrap-servers: localhost:9092  # kafka -> localhost
```

### 2. ì§ë ¬í™”/ì—­ì§ë ¬í™” ì—ëŸ¬

#### Error: Deserialization failed

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
org.apache.kafka.common.errors.SerializationException: 
Error deserializing key/value for partition topic-0 at offset 1
```

**ì›ì¸:**
- Producerì™€ Consumerì˜ Serializer/Deserializer ë¶ˆì¼ì¹˜
- JSON ìŠ¤í‚¤ë§ˆ ë³€ê²½
- ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” íŒ¨í‚¤ì§€

**í•´ê²°ë°©ì•ˆ:**
```java
// 1. JSON ì‹ ë¢° íŒ¨í‚¤ì§€ ì„¤ì •
props.put(JsonDeserializer.TRUSTED_PACKAGES, "*"); // ëª¨ë“  íŒ¨í‚¤ì§€ í—ˆìš© (ê°œë°œìš©)
props.put(JsonDeserializer.TRUSTED_PACKAGES, "com.example.events"); // íŠ¹ì • íŒ¨í‚¤ì§€ë§Œ

// 2. íƒ€ì… ì •ë³´ í¬í•¨
props.put(JsonDeserializer.VALUE_DEFAULT_TYPE, "com.example.events.BaseEvent");

// 3. ìŠ¤í‚¤ë§ˆ í˜¸í™˜ì„±ì„ ìœ„í•œ @JsonIgnoreProperties ì‚¬ìš©
@JsonIgnoreProperties(ignoreUnknown = true)
public class UserEvent {
    // í•„ë“œë“¤
}
```

### 3. ë©”ëª¨ë¦¬ ë° ì„±ëŠ¥ ì—ëŸ¬

#### Error: OutOfMemoryError

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
java.lang.OutOfMemoryError: Java heap space
```

**ì›ì¸:**
- ë°°ì¹˜ í¬ê¸°ê°€ ë„ˆë¬´ í¼
- ë„ˆë¬´ ë§ì€ ë¯¸ì²˜ë¦¬ ë©”ì‹œì§€ ëˆ„ì 
- Consumerê°€ ëŠë ¤ì„œ ë°±í”„ë ˆì…” ë°œìƒ

**í•´ê²°ë°©ì•ˆ:**
```java
// Producer ì„¤ì • ì¡°ì •
props.put(ProducerConfig.BATCH_SIZE_CONFIG, 8192);      // 16384 -> 8192
props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 16777216); // 32MB -> 16MB
props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1);

// Consumer ì„¤ì • ì¡°ì •
props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 100);    // 500 -> 100
props.put(ConsumerConfig.FETCH_MAX_BYTES_CONFIG, 1048576); // 1MB

// JVM í™ í¬ê¸° ì¦ê°€
java -Xmx2G -Xms1G -jar app.jar
```

#### Error: Consumer lag

**ì›ì¸:**
- Consumer ì²˜ë¦¬ ì†ë„ê°€ Producerë³´ë‹¤ ëŠë¦¼
- íŒŒí‹°ì…˜ ìˆ˜ ë¶€ì¡±
- Consumer ì¸ìŠ¤í„´ìŠ¤ ìˆ˜ ë¶€ì¡±

**í•´ê²°ë°©ì•ˆ:**
```bash
# 1. Consumer ê·¸ë£¹ ìƒíƒœ í™•ì¸
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group my-group --describe

# 2. íŒŒí‹°ì…˜ ì¦ê°€
bin/kafka-topics.sh --alter --topic my-topic --partitions 6 --bootstrap-server localhost:9092

# 3. Consumer ì¸ìŠ¤í„´ìŠ¤ ì¦ê°€
@KafkaListener(topics = "my-topic", concurrency = "3")
```

### 4. ì˜¤í”„ì…‹ ê´€ë¦¬ ì—ëŸ¬

#### Error: Offset out of range

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
org.apache.kafka.clients.consumer.OffsetOutOfRangeException: 
Fetch position 1000 is out of range
```

**ì›ì¸:**
- ì˜¤í”„ì…‹ì´ ì‚­ì œë¨ (retention ì„¤ì •)
- ì˜ëª»ëœ ì˜¤í”„ì…‹ ì»¤ë°‹

**í•´ê²°ë°©ì•ˆ:**
```java
// 1. auto-offset-reset ì„¤ì •
props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest"); // ë˜ëŠ” "latest"

// 2. ìˆ˜ë™ ì˜¤í”„ì…‹ ë¦¬ì…‹
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group my-group --topic my-topic --reset-offsets --to-earliest --execute
```

### 5. íŠ¸ëœì­ì…˜ ì—ëŸ¬

#### Error: Transaction timeout

```bash
# ì—ëŸ¬ ë©”ì‹œì§€
org.apache.kafka.common.errors.TimeoutException: 
Timeout of 60000ms expired before successfully committing the transaction
```

**í•´ê²°ë°©ì•ˆ:**
```java
// Producer íŠ¸ëœì­ì…˜ ì„¤ì • ì¡°ì •
props.put(ProducerConfig.TRANSACTION_TIMEOUT_CONFIG, 30000); // 30ì´ˆ
props.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, 30000);

// Broker ì„¤ì • ì¡°ì • (server.properties)
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
```

---

## ì„±ëŠ¥ íŠœë‹ ë° ëª¨ë‹ˆí„°ë§

### 1. Producer ì„±ëŠ¥ íŠœë‹

```java
// ì²˜ë¦¬ëŸ‰ ìµœì í™”
props.put(ProducerConfig.BATCH_SIZE_CONFIG, 32768);        // 32KB
props.put(ProducerConfig.LINGER_MS_CONFIG, 10);            // 10ms ëŒ€ê¸°
props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "snappy"); // ì••ì¶•

// ì§€ì—°ì‹œê°„ ìµœì í™”
props.put(ProducerConfig.BATCH_SIZE_CONFIG, 0);            // ë°°ì¹˜ ë¹„í™œì„±í™”
props.put(ProducerConfig.LINGER_MS_CONFIG, 0);             // ì¦‰ì‹œ ì „ì†¡
props.put(ProducerConfig.ACKS_CONFIG, "1");                // ë¦¬ë”ë§Œ í™•ì¸
```

### 2. Consumer ì„±ëŠ¥ íŠœë‹

```java
// ì²˜ë¦¬ëŸ‰ ìµœì í™”
props.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 50000);      // 50KB
props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500);      // 500ms ëŒ€ê¸°
props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 1000);      // 1000ê°œ

// ë™ì‹œ ì²˜ë¦¬
@KafkaListener(topics = "my-topic", concurrency = "10")
```

### 3. ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­

```yaml
# JMX ë©”íŠ¸ë¦­ í™œì„±í™”
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
```

**ì£¼ìš” ë©”íŠ¸ë¦­:**
- Producer: `kafka.producer.record-send-rate`
- Consumer: `kafka.consumer.records-consumed-rate`  
- Consumer Lag: `kafka.consumer.lag`

### 4. ë¡œê·¸ ì„¤ì •

```xml
<!-- logback-spring.xml -->
<configuration>
    <logger name="org.apache.kafka" level="WARN"/>
    <logger name="org.springframework.kafka" level="INFO"/>
    <logger name="kafka.coordinator" level="INFO"/>
</configuration>
```

---

## ìš´ì˜ í™˜ê²½ ê³ ë ¤ì‚¬í•­

### 1. ë³´ì•ˆ ì„¤ì •

```properties
# server.properties
listeners=SASL_PLAINTEXT://localhost:9092
security.inter.broker.protocol=SASL_PLAINTEXT
sasl.mechanism.inter.broker.protocol=PLAIN
sasl.enabled.mechanisms=PLAIN
```

### 2. ë°±ì—… ë° ë³µêµ¬

```bash
# 1. í† í”½ ì„¤ì • ë°±ì—…
bin/kafka-configs.sh --bootstrap-server localhost:9092 --entity-type topics --describe

# 2. ì˜¤í”„ì…‹ ë°±ì—…
bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --all-groups --describe

# 3. MirrorMakerë¥¼ ì´ìš©í•œ í´ëŸ¬ìŠ¤í„° ë³µì œ
bin/kafka-mirror-maker.sh --consumer.config source-consumer.properties \
  --producer.config target-producer.properties --whitelist=".*"
```

### 3. í´ëŸ¬ìŠ¤í„° í™•ì¥

```bash
# 1. ìƒˆ ë¸Œë¡œì»¤ ì¶”ê°€ í›„ íŒŒí‹°ì…˜ ì¬ë¶„ì‚°
bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file reassignment.json --execute

# 2. íŒŒí‹°ì…˜ ì¦ê°€ (ì£¼ì˜: í‚¤ ê¸°ë°˜ íŒŒí‹°ì…”ë‹ì— ì˜í–¥)
bin/kafka-topics.sh --alter --topic my-topic --partitions 10 \
  --bootstrap-server localhost:9092
```

### 4. ìš©ëŸ‰ ê³„íš

```bash
# ë©”ì‹œì§€ í¬ê¸°ì™€ ì²˜ë¦¬ëŸ‰ ê¸°ë°˜ ê³„ì‚°
ì¼ì¼ ë©”ì‹œì§€ ìˆ˜: 1,000,000
í‰ê·  ë©”ì‹œì§€ í¬ê¸°: 1KB  
ë³´ê´€ ê¸°ê°„: 7ì¼
ë³µì œ ê³„ìˆ˜: 3

í•„ìš” ìš©ëŸ‰ = 1,000,000 Ã— 1KB Ã— 7ì¼ Ã— 3 = 21GB
```

---

## ë§ˆë¬´ë¦¬

ì´ ê°€ì´ë“œëŠ” Kafkaì˜ ê¸°ë³¸ ê°œë…ë¶€í„° ìš´ì˜ í™˜ê²½ê¹Œì§€ì˜ ì „ë°˜ì ì¸ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤. ê° í™˜ê²½ê³¼ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì„¤ì •ì„ ì¡°ì •í•˜ê³ , ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì•ˆì •ì„±ì„ í™•ë³´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

**ì¶”ê°€ í•™ìŠµ ìë£Œ:**
- [Apache Kafka ê³µì‹ ë¬¸ì„œ](https://kafka.apache.org/documentation/)
- [Confluent Platform ë¬¸ì„œ](https://docs.confluent.io/)
- [Spring Kafka ë¬¸ì„œ](https://spring.io/projects/spring-kafka)